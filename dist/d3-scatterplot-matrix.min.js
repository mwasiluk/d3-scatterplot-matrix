function D3ScatterPlotMatrixUtils(){}D3ScatterPlotMatrixUtils.prototype.deepExtend=function(t){var r=this;!t&&arguments.length>1&&arguments[1]instanceof Array&&(t=[]),t=t||{};for(var e=1;e<arguments.length;e++){var n=arguments[e];if(n)for(var o in n)n.hasOwnProperty(o)&&("object"==typeof n[o]?t[o]=r.deepExtend(t[o],n[o]):t[o]=n[o])}return t},D3ScatterPlotMatrixUtils.prototype.cross=function(t,r){var e,n,o=[],i=t.length,a=r.length;for(e=-1;++e<i;)for(n=-1;++n<a;)o.push({x:t[e],i:e,y:r[n],j:n});return o},D3ScatterPlotMatrixUtils.prototype.inferTraits=function(t,r){if(t.length){var e=t[0];if(e instanceof Array)return e.map(function(t,r){return r});if("object"==typeof e){var n=[];for(var o in e)e.hasOwnProperty(o)&&o!=r&&n.push(o);return n}}return[]};
function D3ScatterPlotMatrix(t,i,a){this.utils=new D3ScatterPlotMatrixUtils,this.placeholderSelector=t,this.svg=null,this.defaultConfig={width:0,size:200,padding:20,brush:!0,guides:!0,margin:{left:30,right:30,top:30,bottom:30},x:{orient:"bottom"},y:{orient:"left"},dot:{radius:2,color:!1,d3ColorCategory:"category10"},traits:{labels:[],keys:[],categoryKey:null,value:function(t,i){return t[i]}}},a&&this.setConfig(a),i&&this.setData(i)}D3ScatterPlotMatrix.prototype.setData=function(t){return this.data=t,this},D3ScatterPlotMatrix.prototype.setConfig=function(t){return this.config=this.utils.deepExtend({},this.defaultConfig,t),this},D3ScatterPlotMatrix.prototype.initPlot=function(){var t=this,i=this.config.margin,a=this.config;this.plot={x:{},y:{},dot:{color:null}};var e=a.width,o=d3.select(this.placeholderSelector).node();e||(e=o.getBoundingClientRect().width);var r=e;r||(r=o.getBoundingClientRect().height),this.plot.width=e-i.left-i.right,this.plot.height=r-i.top-i.bottom,this.plot.size=a.size,this.setupTraits(),this.setupX(),this.setupY(),a.dot.d3ColorCategory&&(this.plot.dot.colorCategory=d3.scale[a.dot.d3ColorCategory]());var s=a.dot.color;return s?(this.plot.dot.colorValue=s,"string"==typeof s||s instanceof String?this.plot.dot.color=s:this.plot.dot.colorCategory&&(this.plot.dot.color=function(i){return t.plot.dot.colorCategory(t.plot.dot.colorValue(i))})):a.traits.categoryKey&&(this.plot.dot.color=function(i){return t.plot.dot.colorCategory(i[a.traits.categoryKey])}),this},D3ScatterPlotMatrix.prototype.setupTraits=function(){var t=this.config.traits,i=this.data,a=this.plot;a.domainByTrait={},a.traits=t.keys,a.traits&&a.traits.length||(a.traits=this.utils.inferTraits(i,t.categoryKey)),a.labels=[],a.labelByTrait={},a.traits.forEach(function(e,o){a.domainByTrait[e]=d3.extent(i,function(i){return t.value(i,e)});var r=e;t.labels&&t.labels.length>o&&(r=t.labels[o]),a.labels.push(r),a.labelByTrait[e]=r}),void 0},D3ScatterPlotMatrix.prototype.setupX=function(){var t=this.plot,i=t.x,a=this.config;i.value=a.traits.value,i.scale=d3.scale.linear().range([a.padding/2,t.size-a.padding/2]),i.map=function(t,a){return i.scale(i.value(t,a))},i.axis=d3.svg.axis().scale(i.scale).orient(a.x.orient).ticks(6),i.axis.tickSize(t.size*t.traits.length)},D3ScatterPlotMatrix.prototype.setupY=function(){var t=this.plot,i=t.y,a=this.config;i.value=a.traits.value,i.scale=d3.scale.linear().range([t.size-a.padding/2,a.padding/2]),i.map=function(t,a){return i.scale(i.value(t,a))},i.axis=d3.svg.axis().scale(i.scale).orient(a.y.orient).ticks(6),i.axis.tickSize(-t.size*t.traits.length)},D3ScatterPlotMatrix.prototype.drawPlot=function(){function t(t){var a=d3.select(this),o=i.plot;o.x.scale.domain(o.domainByTrait[t.x]),o.y.scale.domain(o.domainByTrait[t.y]),a.append("rect").attr("class","mw-frame").attr("x",e.padding/2).attr("y",e.padding/2).attr("width",e.size-e.padding).attr("height",e.size-e.padding);var r=a.selectAll("circle").data(i.data).enter().append("circle").attr("cx",function(i){return o.x.map(i,t.x)}).attr("cy",function(i){return o.y.map(i,t.y)}).attr("r",i.config.dot.radius);o.dot.color&&r.style("fill",o.dot.color)}var i=this,a=i.plot.traits.length,e=this.config;i.svgG.selectAll(".mw-axis-x.mw-axis").data(i.plot.traits).enter().append("g").attr("class","mw-axis-x mw-axis"+(e.guides?"":" mw-no-guides")).attr("transform",function(t,e){return"translate("+(a-e-1)*i.plot.size+",0)"}).each(function(t){i.plot.x.scale.domain(i.plot.domainByTrait[t]),d3.select(this).call(i.plot.x.axis)}),i.svgG.selectAll(".mw-axis-y.mw-axis").data(i.plot.traits).enter().append("g").attr("class","mw-axis-y mw-axis"+(e.guides?"":" mw-no-guides")).attr("transform",function(t,a){return"translate(0,"+a*i.plot.size+")"}).each(function(t){i.plot.y.scale.domain(i.plot.domainByTrait[t]),d3.select(this).call(i.plot.y.axis)});var o=i.svgG.selectAll(".mw-cell").data(i.utils.cross(i.plot.traits,i.plot.traits)).enter().append("g").attr("class","mw-cell").attr("transform",function(t){return"translate("+(a-t.i-1)*i.plot.size+","+t.j*i.plot.size+")"}).each(t);o.filter(function(t){return t.i===t.j}).append("text").attr("x",e.padding).attr("y",e.padding).attr("dy",".71em").text(function(t){return i.plot.labelByTrait[t.x]}),e.brush&&this.drawBrush(o)},D3ScatterPlotMatrix.prototype.initSvg=function(){var t=this,i=this.config,a=t.plot.width+i.margin.left+i.margin.right,e=t.plot.height+i.margin.top+i.margin.bottom;t.svg=d3.select(t.placeholderSelector).append("svg").attr("width",a).attr("height",e).attr("viewBox","0 0  "+a+" "+e).attr("preserveAspectRatio","xMidYMid meet").attr("class","mw-d3-scatterplot-matrix"),t.svgG=t.svg.append("g").attr("transform","translate("+i.margin.left+","+i.margin.top+")"),i.width&&!i.height||d3.select(window).on("resize",function(){})},D3ScatterPlotMatrix.prototype.init=function(){var t=this;t.initPlot(),t.initSvg(),t.drawPlot()},D3ScatterPlotMatrix.prototype.drawBrush=function(t){function i(t){s!==this&&(d3.select(s).call(r.clear()),o.plot.x.scale.domain(o.plot.domainByTrait[t.x]),o.plot.y.scale.domain(o.plot.domainByTrait[t.y]),s=this)}function a(t){var i=r.extent();o.svgG.selectAll("circle").classed("hidden",function(a){return i[0][0]>a[t.x]||a[t.x]>i[1][0]||i[0][1]>a[t.y]||a[t.y]>i[1][1]})}function e(){r.empty()&&o.svgG.selectAll(".hidden").classed("hidden",!1)}var o=this,r=d3.svg.brush().x(o.plot.x.scale).y(o.plot.y.scale).on("brushstart",i).on("brush",a).on("brushend",e);t.call(r);var s};